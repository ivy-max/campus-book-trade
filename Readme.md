# 校园二手书籍交易平台

本项目是一个面向高校师生的二手书籍交易平台，包含微信小程序前端和 Django + MySQL 后端。平台支持书籍发布、分类浏览、订单管理、消息通知、用户信用分等功能，致力于为校园用户提供安全、便捷的二手书交易体验。

---

## 目录结构

```
miniprogram-6 4/                # 项目根目录
│
├── Campus-Book-Trade/          # 后端 Django 项目
│   ├── books/                  # 书籍相关后端模块
│   ├── chats/                  # 聊天相关后端模块
│   ├── notifications/          # 通知相关后端模块
│   ├── order/                  # 订单相关后端模块
│   ├── user_collections/       # 用户收藏相关后端模块
│   ├── users/                  # 用户相关后端模块
│   ├── campus_book_trade/      # Django 主配置
│   ├── sql/                    # 数据库建表、触发器、初始化脚本
│   └── media/                  # 用户上传的图片、头像等
│
├── api/                        # 小程序端API请求封装
├── assets/                     # 小程序端静态资源
├── config/                     # 小程序端配置
├── mock/                       # 小程序端mock数据
├── order/                      # 小程序端订单相关页面
├── orderList/                  # 小程序端订单列表页面
├── pages/                      # 小程序端各功能页面
├── utils/                      # 小程序端工具函数
├── typings/                    # 小程序端类型定义
├── app.js/json/wxss            # 小程序全局配置
├── package.json                # 小程序依赖
└── ...                         # 其他配置文件
```

---

## 快速开始

### 1. 后端（Django）

#### 环境准备
- Python 3.8+
- MySQL 5.7/8.0
- 推荐使用虚拟环境（如 myenv)
- 创建虚拟环境
python -m venv myenv
- 激活虚拟环境
Windows:
myenv\Scripts\activate
Linux/MacOS:
source myenv/bin/activate

#### 安装依赖
```bash
cd Campus-Book-Trade
pip install -r requirements.txt
```

#### 数据库初始化
1. 创建数据库（如 `campus_book_trade`），并导入 `sql/` 目录下的建表脚本（顺序建议）：
   - `create_users_table.sql`
   - `create_books_table.sql`
   - `create_order_table.sql`
   - `create_collections_table.sql`
   - `create_notifications_table.sql`
   - `create_chats_table.sql`
   - `create_triggers.sql`
2. 可选：运行 `setup_database.py` 进行自动化初始化。

#### 启动后端服务
```bash
python manage.py runserver
```
默认端口为 `8000`，API 根路径为 `http://127.0.0.1:8000/`

---

### 2. 前端（微信小程序）

#### 环境准备
- 微信开发者工具
- Node.js（如需本地依赖管理）

#### 运行步骤
1. 用微信开发者工具打开项目根目录。
2. 配置 `app.json`、`project.config.json` 等小程序参数。
3. 如需本地调试API，确保后端服务已启动并允许跨域。

---

## 主要功能

- **用户系统**：微信一键登录、个人信息、信用分管理
- **书籍管理**：书籍发布、分类、搜索、详情
- **订单系统**：下单、支付、评价、订单状态流转
- **消息通知**：系统消息、订单消息、聊天消息
- **信用分机制**：自动触发器计算、日志记录、等级划分
- **收藏与历史**：用户收藏、浏览历史

---

## 数据库说明

- 所有建表、触发器、存储过程SQL均在 `Campus-Book-Trade/sql/` 目录下
- 触发器和存储过程用于自动计算和维护用户信用分
- 重要表：`users`、`books_book`、`order_order`、`credit_calculation_log`、`trigger_debug_log`
- 如有表结构调整，请同步更新 SQL 脚本和 Django models

---

## 贡献与反馈

如有建议、Bug反馈或贡献代码，请提交 Issue 或 Pull Request。

---

## License

本项目仅供学习交流使用，禁止用于商业用途。

---

## 页面功能与设计

本项目小程序端包含以下核心页面，每个页面均围绕用户体验与业务流程精心设计：

### 1. 二手商城首页
- 书籍列表展示：以卡片形式展示在售二手书籍，卡片包含价格、封面等关键信息。点击卡片可查看书籍详情，包括出版社、作者、ISBN、新旧程度、详细描述等。
- 搜索与筛选：页面顶部集成模糊搜索框，支持关键词检索。提供多维度筛选（如校区），便于用户精准查找目标书籍。
- 书籍发布入口：页面底部中央设有"发布"按钮，点击后弹出书籍发布表单，支持填写详细信息及图片上传。
- 公告栏：位于页面顶部，展示管理员发布的公告、交易规则及注意事项，提升交易安全性与合规性。

### 2. 分类浏览页面
- 多级分类导航：支持按书籍类别、校区（如邯郸、枫林、江湾、张江）、专业（如经济、管理、大数据、思政、英语等）进行多级筛选。
- 分类结果展示：用户可通过多选筛选条件，快速定位所需书籍，提升检索效率。

### 3. 消息中心页面
- 聊天功能：支持买卖双方基于订单进行实时文字与图片沟通，自动关联相关商品，显示消息已读/未读状态。
- 系统通知：集成交易状态变更、评价提醒、平台公告等系统消息，支持消息推送与历史消息查询，保障用户信息及时送达。

### 4. 个人中心页面
- 个人信息管理：支持用户修改头像、昵称、密码、绑定手机号等个人资料，展示及管理信用评分。
- 订单管理：集中展示用户全部订单，涵盖待付款、待发货、已发货、已完成等多种状态，支持订单评价与进度跟踪。
- 收藏与历史：用户可管理收藏书籍，支持按添加时间、价格等维度排序，便于个性化管理。
- 信用分展示：详细展示信用评分构成及提升建议，增强用户诚信意识与平台信任度。
